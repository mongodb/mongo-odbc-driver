<?xml version="1.0" encoding="UTF-8"?>
<!-- Copyright (c) 2018-Present MongoDB Inc. -->
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
    <Fragment>
        <DirectoryRef Id="BIN">
            <Component Id="cmp_BinPermissions" Guid="bc6c8ba6-46bc-4175-b877-1ffcc07b4fd7">
               <CreateFolder>
                    <!-- Sddl generated from `cacls "C:\Program Files\MongoDB\Atlas SQL ODBC Driver\" /S` -->
                    <!-- This will set the same permissions if installed in a custom directory or in the default directory -->
                    <PermissionEx Sddl="D:AI(A;ID;FA;;;S-1-5-80-956008885-3418522649-1831038044-1853292631-2271478464)(A;CIIOID;GA;;;S-1-5-80-956008885-3418522649-1831038044-1853292631-2271478464)(A;ID;FA;;;SY)(A;OICIIOID;GA;;;SY)(A;ID;FA;;;BA)(A;OICIIOID;GA;;;BA)(A;ID;0x1200a9;;;BU)(A;OICIIOID;GXGR;;;BU)(A;OICIIOID;GA;;;CO)(A;ID;0x1200a9;;;AC)(A;OICIIOID;GXGR;;;AC)(A;ID;0x1200a9;;;S-1-15-2-2)(A;OICIIOID;GXGR;;;S-1-15-2-2)"/>
                </CreateFolder>
            </Component>
            <?if $(var.Platform)=x64?>
            <?define win64Flag = "yes"?>
            <?else ?>
            <?define win64Flag = "no"?>
            <?endif ?>
            <Component Id="InstallDriver"
                Guid="*"
                Win64="$(var.win64Flag)">
                <File Id="atsql.dll"
                    Name="atsql.dll"
                    Source="atsql.dll" />
                <File Id="atsqls.dll"
                    Name="atsqls.dll"
                    Source="atsqls.dll" />
                <RegistryKey ForceCreateOnInstall="yes"
                    ForceDeleteOnUninstall="yes"
                    Id="MongoDBKey"
                    Key="SOFTWARE\MongoDB\[ProductName]"
                    Root="HKLM" />
                <RegistryValue Id="Version"
                    Key="SOFTWARE\MongoDB\[ProductName]"
                    Name="Version"
                    Root="HKLM"
                    Type="string"
                    Value="[ProductVersion]" />
                <RegistryValue Id="mongodb.reg.installed"
                    Root="HKLM"
                    Key="SOFTWARE\ODBC\ODBCINST.INI\ODBC Drivers"
                    Name="MongoDB Atlas SQL ODBC Driver"
                    Type="string"
                    Value="Installed" />
                <RegistryValue Id="mongodb.reg.driver"
                    Root="HKLM"
                    Key="SOFTWARE\ODBC\ODBCINST.INI\MongoDB Atlas SQL ODBC Driver"
                    Name="Driver"
                    Type="string"
                    Value="[#atsql.dll]" />
                <RegistryValue Id="mongodb.reg.setup"
                    Root="HKLM"
                    Key="SOFTWARE\ODBC\ODBCINST.INI\MongoDB Atlas SQL ODBC Driver"
                    Name="Setup"
                    Type="string"
                    Value="[#atsqls.dll]" />
            </Component>
        </DirectoryRef>
        <ComponentGroup Id="base">
            <ComponentRef Id="InstallDriver" />
            <ComponentRef Id="cmp_BinPermissions" />
        </ComponentGroup>
    </Fragment>
</Wix>
